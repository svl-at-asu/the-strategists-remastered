# The Strategists - Backend Service

This directory contains the _Spring Boot_ application for The Strategists game.

## Setup

1. Please ensure you have `java` installed on your system to continue. The project requires `v21`, and recommends using
   `openjdk@21` specifically.
2. Import the `maven` project in the IDE of your choice. We recommend using [IntelliJ](https://www.jetbrains.com/idea/)
   since all the source code is formatted using _IntelliJ_.
3. Configure Environment variables & VM arguments mentioned in the following section.
4. After setting up Environment variables & VM arguments, run `com.strategists.game.StrategistsService` to start the
   backend service.

### Setting up Environment Variables & VM Arguments

All the VM arguments are mentioned in the [`application.yml`](./src/main/resources/application.yml) file,
including a few environment variables that can be configured on run-time. A list of those are mentioned below.

In addition to all the configurations mentioned in the `application.yml` file, please refer to the following variables
required to run the server.

| Variable                                         | Description                                                                                                                                                                                                                                                                                                    | Type      | Default Value           |
|--------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------|-------------------------|
| `ENABLE_H2_CONSOLE`                              | If set, the server will expose the H2 database console URL by the server.                                                                                                                                                                                                                                      | `boolean` | `false`                 |
| `ENABLE_SSE_PING`                                | If set, the server will send a periodic ping to keep the SSE channel open.                                                                                                                                                                                                                                     | `boolean` | `true`                  |
| `ENABLE_CLEAN_UP`                                | If set, the server will delete games after some time of inactivity.                                                                                                                                                                                                                                            | `boolean` | `true`                  |
| `ENABLE_SKIP_PLAYER`                             | If set, the server will skip players' turns after some time of inactivity.                                                                                                                                                                                                                                     | `boolean` | `true`                  |
| `ENABLE_PERMISSIONS`                             | If set, the server will enable the Permissions API integration.<br/>Enabling permissions will not automatically enable _Google ReCAPTCHA_ verification or enforcing user permissions.<br/>Refer to the environment variables below to configure those features.                                                | `boolean` | `false`                 |
| `ENABLE_PERMISSIONS_HEALTH_CHECK_API`            | If set, the server will ensure the Permissions API is healthy before starting.                                                                                                                                                                                                                                 | `boolean` | `true`                  |
| `ENABLE_PERMISSIONS_GOOGLE_RECAPTCHA_VERIFY_API` | If set, the server will enable _Google ReCAPTCHA_ verification for user actions that require permissions.<br/>This requires `ENABLE_PERMISSIONS` to be enabled, and _Google ReCAPTCHA_ configured.<br/>Refer to [docs](../docs/google-integration.md#google-recaptcha) for more information.                   | `boolean` | `false`                 |
| `ENABLE_PERMISSIONS_PERMISSION_GROUP_API`        | If set, the server will enable Permission Group checks via the Permissions API.<br/>This requires `ENABLE_PERMISSIONS` to be enabled, and _Google Spreadsheet_ configured.<br/>Refer to [docs](../docs/google-integration.md#google-spreadsheets) for more information.                                        | `boolean` | `false`                 |
| `PERMISSIONS_API_HOST`                           | Permissions API's host name.                                                                                                                                                                                                                                                                                   | `String`  | `http://localhost:8001` |
| `ENABLE_STORAGE`                                 | If set, the server will enable the Storage API integration.<br/>This is required for uploading and downloading game-related data to/from _Google Drive_.<br/>Enabling storage will not automatically enable _Google Drive_ features.<br/>Refer to the environment variables below to configure those features. | `boolean` | `false`                 |
| `ENABLE_STORAGE_HEALTH_CHECK_API`                | If set, the server will ensure the Storage API is healthy before starting.                                                                                                                                                                                                                                     | `boolean` | `true`                  |
| `ENABLE_STORAGE_DOWNLOAD_API`                    | If set, the server will enable downloading files from _Google Drive_ via the Storage API.<br/>This requires `ENABLE_STORAGE` to be enabled, and _Google Drive_ configured.<br/>Refer to [docs](../docs/google-integration.md#google-drive) for more information.                                               | `boolean` | `false`                 |
| `ENABLE_STORAGE_UPLOAD_API`                      | If set, the server will enable uploading files to _Google Drive_ via the Storage API.<br/>This requires `ENABLE_STORAGE` to be enabled, and _Google Drive_ configured.<br/>Refer to [docs](../docs/google-integration.md#google-drive) for more information.                                                   | `boolean` | `false`                 |
| `STORAGE_API_HOST`                               | Storage API's host name.                                                                                                                                                                                                                                                                                       | `String`  | `http://localhost:8002` |
| `HISTORY_DATA_DIR`                               | Path to a directory where games' history `JSONL` files will be exported.                                                                                                                                                                                                                                       | `String`  | `../resources/history/` |
| `ENABLE_HISTORY_GOOGLE_DRIVE_SYNC`               | If set, the server will attempt to sync games' history `JSONL` files with _Google Drive_.<br/>This requires `ENABLE_STORAGE_DOWNLOAD_API` and `ENABLE_STORAGE_UPLOAD_API` to be enabled, and _Google Drive_ configured.<br/>Refer to [docs](../docs/google-integration.md#google-drive) for more information.  | `boolean` | `false`                 |
| `HISTORY_FOLDER_ID`                              | _Google Drive_ folder `ID` to where games' history `JSONL` files will be uploaded to and downloaded from.                                                                                                                                                                                                      | `String`  | none                    |
| `ENABLE_PREDICTIONS`                             | If set, the server will train and execute the prediction model.                                                                                                                                                                                                                                                | `boolean` | `false`                 |
| `ENABLE_PREDICTIONS_HEALTH_CHECK_API`            | If set, the server will ensure the Predictions API is healthy before starting.                                                                                                                                                                                                                                 | `boolean` | `true`                  |
| `ENABLE_PREDICTIONS_LOAD_MODEL_INFO_API`         | If set, the server will check if the prediction model is trained via the Predictions API for a given map.<br/>This requires `ENABLE_PREDICTIONS` to be enabled.                                                                                                                                                | `boolean` | `false`                 |
| `ENABLE_PREDICTIONS_TRAIN_MODEL_API`             | If set, the server will train the prediction model via the Predictions API for a given map.<br/>This requires `ENABLE_PREDICTIONS` to be enabled, and pre-existing history data available.                                                                                                                     | `boolean` | `false`                 |
| `ENABLE_PREDICTIONS_INFER_MODEL_API`             | If set, the server will infer the prediction model via the Predictions API for a given map.<br/>This requires `ENABLE_PREDICTIONS` to be enabled, and pre-existing history data available.                                                                                                                     | `boolean` | `false`                 |
| `PREDICTIONS_API_HOST`                           | Predictions API's host name.                                                                                                                                                                                                                                                                                   | `String`  | `http://localhost:8003` |
| `ENABLE_PREDICTIONS_TRAIN_ON_STARTUP`            | If set, the server will train the prediction model on server start-up, if model is not trained before.                                                                                                                                                                                                         | `boolean` | `true`                  |
| `ENABLE_PREDICTIONS_TRAIN_ON_END`                | If set, the server will train the prediction model when game ends.                                                                                                                                                                                                                                             | `boolean` | `true`                  |
| `ENABLE_PREDICTIONS_MODEL_INFERENCE`             | If set, the server will infer the model for predictions.                                                                                                                                                                                                                                                       | `boolean` | `true`                  |
| `LEGACY_PREDICTIONS_DATA_DIR`                    | Path to a directory where legacy predictions `CSV` files will be exported.                                                                                                                                                                                                                                     | `String`  | `../resources/legacy`   |
| `ENABLE_LEGACY_PREDICTIONS_DATA_EXPORT`          | If set, the server will export the legacy predictions `CSV` files to the provided data directory.<br/>This is not recommended since legacy predictions are deprecated over history files, but is provided for backward compatibility.                                                                          | `boolean` | `false`                 |
| `ENABLE_LEGACY_PREDICTIONS_DATA_DOWNLOAD`        | If set, the server will download the legacy predictions `CSV` files from _Google Drive_.<br/>This requires `ENABLE_STORAGE_DOWNLOAD_API` to be enabled, and _Google Drive_ configured.<br/>Refer to [docs](../docs/google-integration.md#google-drive) for more information.                                   | `boolean` | `false`                 |
| `LEGACY_PREDICTIONS_FOLDER_ID`                   | _Google Drive_ folder `ID` from where legacy predictions `CSV` files will be downloaded.                                                                                                                                                                                                                       | `String`  | none                    |
| `ENABLE_ADVICES`                                 | If set, the server will generate advices for players.                                                                                                                                                                                                                                                          | `boolean` | `true`                  |
| `ENABLE_FREQUENTLY_INVEST_ADVICE`                | If set, the server will generate "frequently invest" advice for players.                                                                                                                                                                                                                                       | `boolean` | `true`                  |
| `ENABLE_AVOID_TIMEOUT_ADVICE`                    | If set, the server will generate "avoid timeout" advice for players.                                                                                                                                                                                                                                           | `boolean` | `true`                  |
| `ENABLE_SIGNIFICANT_INVESTMENTS_ADVICE`          | If set, the server will generate "significant investments" advice for players.                                                                                                                                                                                                                                 | `boolean` | `true`                  |
| `ENABLE_CONCENTRATE_INVESTMENTS_ADVICE`          | If set, the server will generate "concentrate investments" advice for players.                                                                                                                                                                                                                                 | `boolean` | `true`                  |
| `ENABLE_POTENTIAL_BANKRUPTCY_ADVICE`             | If set, the server will generate "potential bankruptcy" advice for players.                                                                                                                                                                                                                                    | `boolean` | `true`                  |

> [!NOTE]
> You can pass these environment variables and other VM arguments to the application as `-D<VARIABLE_NAME>=<VALUE>`
> by adding them to the VM arguments section of the run configuration in your IDE.

## References

- Read more about the starter `Dockerfile` for maven projects from
  [this StackOverflow article](https://stackoverflow.com/questions/27767264/how-to-dockerize-maven-project-and-how-many-ways-to-accomplish-it).
